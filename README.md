# vassign
RAN-aware video quality selection algorithms

# Requirements
- Python 3: You can create a virtual environment and install the dependencies in requirements.txt.
- CPLEX: To use the branch and cut algorithm (cplex directory), you need CPLEX 12.10 
(tested with Python 3.6.8; other CPLEX versions might also work).

# Model
These algorithms solve a video representation assignment problem for users connected in an LTE network.
The aim is to select for each user connected to a DASH video streaming service a video representation 
with known bitrate and quality (MOS) under network and individual link capacity constraints. Network capacity is
expressed in terms of Physical Resource Blocks and each user has a known link quality (CQI value), translated
to maximum achievable throughput according to Tables 7.2.3-2 and 7.1.7.1-1A of 3GPP TS 36.213 (Release 14).
The objective is to maximize the sum of the MOS values across all users.

# Algorithms
- Branch and cut (`cplex`)
- Genetic algorithm (`ga`)
- Baseline heuristic (`heuristic`)

# Running the algorithms
You can run each algorithm individually or execute a set of tests to compare their performance in terms
of their solution quality and execution time (`testing` directory).

## Generating test scenarios
You can use `ga/generate.py` to generate a test scenario as follows:
```
python generate.py -s seed -n number_of_users -p number_of_prbs -o output_file
```
The seed and output file are optional. The number of PRBs should either be 25 or 100. Scenarios can also
be generated programmatically:
```python
from vassign import *

nprb = 100
nusers = 1000
outpath = "outfile.json"
randomize_video = False
generate_scenario(nprb, nusers, outpath, randomize_video)
```
The last parameter allows to generate random video representations. If set to false, the video representations
hardcoded in `generate.py` and which correspond to actual video are used.

## `cplex`
The code to solve the problem via cplex is in `cplex/vassing.py`. You can invoke it as follows:
```
python vassign.py -c /path/to/configfile
```
where `configfile` is a scenario file generated by `generate.py`. 

The solver can also be called programmatically:
```python
from vassign import *
from generate import *
import json

nprb = 100
nusers = 1000
outpath = "outfile.json"
randomize_video = False

# Number of threads to be used by cplex. Default: 0 (use as many as the CPU cores in the system)
nthreads = 3

# Generate a scenario
generate_scenario(nprb, nusers, outpath, randomize_video)

# Load scenario from file
with open("outfile.json") as fp:
  configuration = json.load(fp)

# Solve the problem
solution = vassign(configuration, threads)

# Get objective function value of the optimal solution
optval = solution["objective"]
```
The `solution` variable includes the scenario augmented with a video assignment per user and information about the solution.

## `ga`
To run the genetic algorithm directly, a yaml file with the algorithm settings and a scenario file (as e.g. generated by
`generate.py` are necessary). The GA configuration file looks like the following:
```python
crossover_rate: 0.5
mutation_rate: 0.01
solution_pool_size: 30
generations: 30
convergence_check: True
delta: 0.01
stop_after: 15
scenario_file: "scenario.json"
solution_file: "./solution.json"
generations_file: "./generations.dat"
loglevel: "NONE"
seed: 1590676873029
```
The algorithm can be run as follows (main.py is the the `ga` folder):
```
python main.py -c settings.yaml
```

It is also possible to invoke the algorithm programmatically:
```python
from ga import *
from generate import *

nprb = 100
nusers = 1000
outpath = "outfile.json"
randomize_video = False

# Generate a scenario
generate_scenario(nprb, nusers, outpath, randomize_video)

# Generate ga configuration object
settings = {
  "crossover_rate": 0.5,
  "mutation_rate": 0.0,
  "solution_pool_size": 40,
  "generations": 30,
  "convergence_check": True,
  "delta": 0.01,
  "stop_after": 15,
  "scenario_file": "outfile.json",
  "solution_file": "./solution.json",
  "generations_file": "./generations.dat",
  "loglevel": "NONE",
}

# Load scenario file
with open("outfile.json") as fp:
  configuration = json.load(fp)

# Create a GA object
g = GA(settings)

# Run the algorithm
solution = g.execute()

# Get the objective function value of the solution returned
val = solution["fitness"]
```

## `heuristic`
To call the baseline heuristics from command line:
```
python heuristic.py -i scenario_file -o output_file -s
```
In silent mode (-s), the solution will be also printed to stdout. Otherwise, only the 
objective function value is output. The scenario file can be generated by `generate.py`. 
To invoke the algorithm programmatically, as in the other cases:
```python
from generate import *
from heuristic import *
import json

nprb = 100
nusers = 1000
outpath = "outfile.json"
randomize_video = False

# Generate a scenario
generate_scenario(nprb, nusers, outpath, randomize_video)

# Load scenario file
with open("outfile.json") as fp:
  configuration = json.load(fp)

# Run heuristic
h = Heuristic(configuration)
solution = h.execute()
val = solution["objective"]
```

## Benchmarks
In `testing` there are tools to compare the performance of the algorithms and plot the results.
The test parameters (iterations, confidence intervals, range of users, GA parameters, etc.)
have to be set directly in `experiments.py`. To run a set of experiments, create plots of
the results, and assuming that a Python 3 virtual environment is in place in the `venv` directory
with all the requirements installed:
```
. venv/bin/activate
export PYTHONPATH=../cplex/:../ga:../heuristic
python experiments.py > results.dat
gnuplot -e "datafile='results.dat'" plot.gp
```

